pred_search,rule_title,severity
"| tstats summariesonly=true distinct_count(Authentication.user) as accounts from datamodel=Authentication WHERE [| inputlookup csapp_wl_access.csv WHERE rulename=tstats_auth OR rulename=cs_adps | fields - rulename, description | format """" ""NOT ("" ""AND"" """" "")"" "")"" | eval search=if(search=""NOT ()"", ""*"", search)]  (Authentication.EventCode=""4625"" AND (Authentication.Sub_Status=""0xC0000064"" OR Authentication.Sub_Status=""0xC000006A"")) OR (Authentication.EventCode=4771 AND Authentication.Failure_Code=""0x18"") by Authentication.src, _time span=15m | eval date_day=strftime(_time,""%d"") | search accounts > 30 | rename Authentication.src as src | dedup date_day, src",Active Directory Password Spray,high
"|tstats allow_old_summaries=true count from datamodel=Windows.Windows WHERE [| inputlookup csapp_wl_access.csv WHERE rulename=tstats_win OR rulename=cs_asa | fields - rulename, description | format """" ""NOT ("" ""AND"" """" "")"" "")"" | eval search=if(search=""NOT ()"", ""*"", search)]  Windows.EventCode=5140 Windows.Share_Name=*Admin$* NOT [inputlookup csapp_adminshare_approved.csv] by Windows.Account_Name, _time span=1h | eval date_day=strftime(_time,""%d"") |`drop_dm_object_name(""Windows"")` | rename Account_Name as user | dedup date_day, user",Admin Share Access,low
"| tstats summariesonly=true allow_old_summaries=true max(_time) as ""lastTime"", values(Authentication.tag) as ""tag"", values(Authentication.action) as ""action"", count from datamodel=Authentication.Authentication WHERE [| inputlookup csapp_wl_access.csv WHERE rulename=tstats_auth OR rulename=cs_daad | fields - rulename, description | format """" ""NOT ("" ""AND"" """" "")"" "")"" | eval search=if(search=""NOT ()"", ""*"", search)] [| inputlookup administrative_identity_lookup | makemv delim=""|"" category | mvexpand category | search category=default | table identity | rename identity AS Authentication.user | format """" """" ""AND"" """" ""OR"" """"] OR [| inputlookup identity_lookup_expanded where category=""default"" | mvexpand identity | table identity | rename identity AS Authentication.user | format """" """" ""AND"" """" ""OR"" """"] by ""Authentication.dest"",""Authentication.user"",""Authentication.app"", _time span=1h | eval date_day=strftime(_time,""%d"")
| search Authentication.user!=""LOCAL SERVICE"" Authentication.user!=""NETWORK SERVICE"" Authentication.user!=""SYSTEM""
| eval lastTime=strftime(lastTime, ""%d/%m/%Y %H:%M:%S"")
| rename ""Authentication.dest"" as ""dest"",""Authentication.user"" as ""user"",""Authentication.app"" as ""app""
| table lastTime, app, user, dest, action, count, tag, date_day
| dedup date_day, user, dest",Default Account Activity Detected,low
"| tstats summariesonly=true allow_old_summaries=true dc(Authentication.user) as ""user_count"", dc(Authentication.dest) as ""dest_count"", count from datamodel=Authentication.Authentication  WHERE [| inputlookup csapp_wl_access.csv WHERE rulename=tstats_auth OR rulename=cs_efl | fields - rulename, description | format """" ""NOT ("" ""AND"" """" "")"" "")"" | eval search=if(search=""NOT ()"", ""*"", search)] nodename=Authentication.Failed_Authentication [| inputlookup csapp_windows_f_l_wh_dm.csv | format """" ""("" ""AND"" "")"" ""OR"" """"]  by ""Authentication.src"",""Authentication.app"", _time span=15m | eval date_day=strftime(_time,""%d"")
|`drop_dm_object_name(""Authentication"")` | where 'count'>=50
| dedup date_day, src, app",Excessive Failed Logins,medium
"| tstats summariesonly=true allow_old_summaries=true count from datamodel=Authentication.Authentication WHERE [| inputlookup csapp_wl_access.csv WHERE rulename=tstats_auth OR rulename=cs_efltdea | fields - rulename, description | format """" ""NOT ("" ""AND"" """" "")"" "")"" | eval search=if(search=""NOT ()"", ""*"", search)]  nodename=Authentication.Failed_Authentication [| inputlookup csapp_windows_disabled_account_f_l_wh_dm.csv | format """" ""("" ""AND"" "")"" ""OR"" """"]   by ""Authentication.src"",""Authentication.app"", _time span=1h | eval date_day=strftime(_time,""%d"")
|`drop_dm_object_name(""Authentication"")`
| where count >=50 | dedup date_day, src, app",Excessive Failed Logins to Disabled, Expired or Locked Account
"| tstats summariesonly=true allow_old_summaries=true dc(Authentication.user) as ""user_count"", dc(Authentication.dest) as ""dest_count"", count from datamodel=Authentication.Authentication WHERE [| inputlookup csapp_wl_access.csv WHERE rulename=tstats_auth OR rulename=cs_asa | fields - rulename, description | format """" ""NOT ("" ""AND"" """" "")"" "")"" | eval search=if(search=""NOT ()"", ""*"", search)]  nodename=Authentication.Failed_Authentication [| inputlookup csapp_windows_f_l_wh_dm.csv | format """" ""("" ""AND"" "")"" ""OR"" """"]  by ""Authentication.src"",""Authentication.app"", _time span=15m | eval date_day=strftime(_time,""%d"")
|`drop_dm_object_name(""Authentication"")`
| where 'count'>250 | dedup date_day, src, app",Extreme Number of Failed Logins,high
"| tstats allow_old_summaries=true distinct_count(Windows.Share_Name) as shares, values(Windows.Share_Name) from datamodel=Windows.Windows WHERE [| inputlookup csapp_wl_access.csv WHERE rulename=tstats_win OR rulename=cs_fse | fields - rulename, description | format """" ""NOT ("" ""AND"" """" "")"" "")"" | eval search=if(search=""NOT ()"", ""*"", search)]  Windows.EventCode=5140 by Windows.Account_Name, host, _time span=1h
| stats sum(shares) AS Total_shares, dc(host) AS DC_hosts by Windows.Account_Name, _time  | search Total_shares > 10 DC_hosts > 8 |`drop_dm_object_name(""Windows"")` | rename Account_Name AS user | eval date_day=strftime(_time,""%d"") | dedup date_day, user",File Share Enumeration,medium
"| tstats allow_old_summaries=true count, values(host) from datamodel=Windows.Windows WHERE [| inputlookup csapp_wl_access.csv WHERE rulename=tstats_win OR rulename=cs_hpgq | fields - rulename, description | format """" ""NOT ("" ""AND"" """" "")"" "")"" | eval search=if(search=""NOT ()"", ""*"", search)]  Windows.EventCode=4661 [inputlookup csapp_privileged_groups.csv | rename Group as Windows.Object_Name] Windows.Account_Name!=domain-DC0*$ by Windows.Account_Name, Windows.Object_Name, host, _time span=30m | eval date_day=strftime(_time,""%d"") |`drop_dm_object_name(""Windows"")` | rename Account_Name AS user | dedup date_day, user",High Privileged Group Query,medium
"| tstats summariesonly=true max(_time) as ""lastTime"",values(Authentication.tag) as ""tag"" from datamodel=Authentication WHERE [| inputlookup csapp_wl_access.csv WHERE rulename=tstats_auth OR rulename=cs_iocad | fields - rulename, description | format """" ""NOT ("" ""AND"" """" "")"" "")"" | eval search=if(search=""NOT ()"", ""*"", search)]  nodename=Authentication.Insecure_Authentication by Authentication.app, Authentication.dest, _time span=1h | eval wnumber=strftime(_time,""%V"") | eval lastTime=strftime(lastTime, ""%c"") | `drop_dm_object_name(""Authentication"")` | dedup wnumber, app, dest",Insecure Or Cleartext Authentication Detection,high
"| tstats summariesonly=true values(tag) as ""tag"",dc(Authentication.user) as ""user_count"",dc(Authentication.dest) as ""dest_count"",count from datamodel=Authentication WHERE [| inputlookup csapp_wl_access.csv WHERE rulename=tstats_auth OR rulename=cs_mflrvr | fields - rulename, description | format """" ""NOT ("" ""AND"" """" "")"" "")"" | eval search=if(search=""NOT ()"", ""*"", search)]  nodename=Authentication.Failed_Authentication AND `csapp_win-restrictionviolation` by Authentication.app, Authentication.src,_time span=1h | eval date_day=strftime(_time,""%d"") | where 'count'>=6 | rename ""Authentication.app"" as ""app"",""Authentication.src"" as ""src"" | dedup date_day, src, app",Multiple Failed Logins - Restriction Violation,low
"| tstats summariesonly=true dc(Authentication.user) as ""user_count"",dc(Authentication.dest) as ""dest_count"",count from datamodel=Authentication WHERE [| inputlookup csapp_wl_access.csv WHERE rulename=tstats_auth OR rulename=cs_mfl | fields - rulename, description | format """" ""NOT ("" ""AND"" """" "")"" "")"" | eval search=if(search=""NOT ()"", ""*"", search)]   nodename=Authentication.Failed_Authentication AND `csapp-final-evtcode-whitelist` by Authentication.app, Authentication.src, _time span=1h | eval date_day=strftime(_time,""%d"") | rename ""Authentication.src"" as ""src"", ""Authentication.app"" as app | where 'count'>=10 AND 'count'<49 | dedup date_day, src",Multiple Failed Logins,informational
"| tstats `summariesonly` count from datamodel=Change_Analysis.All_Changes where nodename=""All_Changes.Account_Management"" (All_Changes.action=""created"" OR All_Changes.action=""deleted"") [| inputlookup csapp_wl_access.csv WHERE rulename=tstats_changes OR rulename=cs_slad | fields - rulename, description | format """" ""NOT ("" ""AND"" """" "")"" "")"" | eval search=if(search=""NOT ()"", ""*"", search)]  by _time span=1s,All_Changes.dest,All_Changes.user,All_Changes.action | sort _time | transaction All_Changes.user maxevents=2 startswith=""All_Changes.action=deleted"" endswith=""All_Changes.action=created"" | search duration<`useraccount_minimal_lifetime` | `uptime2string(duration,timestr)` | stats count, values(All_Changes.dest) AS dest by All_Changes.user, timestr | `drop_dm_object_name(""All_Changes"")` | table user, dest, timestr",Short-Lived Account Detected,high
"| datamodel Windows search | search Windows.EventCode=4728  [| inputlookup csapp_wl_access.csv WHERE rulename=tstats_win OR rulename=cs_uathpg | fields - rulename, description | format """" ""NOT ("" ""AND"" """" "")"" "")"" | eval search=if(search=""NOT ()"", ""*"", search)] | `drop_dm_object_name(""Windows"")`
| eval Subject=mvindex(Security_ID, 0) | eval Member=mvindex(Security_ID, 1) | rex field=Member ""\w+\\\(?<Member>.*)"" | eval Group=mvindex(Security_ID, 2) | search [inputlookup csapp_privileged_groups.csv] | rename Subject AS user | table _time, user, Member, Group | eval date_day=strftime(_time,""%d"") | dedup date_day, user",User Added to High Privileged Group,high
